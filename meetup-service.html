<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../polymer-jsonp/polymer-jsonp.html">

<polymer-element name="meetup-service" attributes="data urlName key sig sigId dataFormat limit">
  <template>
    <style>
    :host {
      display: none;
    }
    </style>
    <polymer-jsonp auto id="jsonp" url="{{url}}"
      on-polymer-response="{{dataLoaded}}"></polymer-jsonp>
  </template>
  <script>
  Polymer('meetup-service', {
    created: function() {
      this.data = [];
    },
    ready: function() {


      var status;
      var limit;

      // Depending on the service command provided (chosen from our published API),
      // we can dynamically build the URL for the polymer-jsonp element
      console.log(this.dataFormat);

      switch (this.dataFormat) {

          case 'upcoming-meetups':

              status = "upcoming";
              this.url = "http://api.meetup.com/2/events?" +
                 "sign=true" +
                 "&status=" + status +
                 "&order=time" +
                 "&limited_events=False" +
                 "&group_urlname=" + this.urlName +
                 "&desc=false" +
                 "&offset=0" +
                 "&photo-host=public" +
                 "&format=json" +
                 "&page=200" +
                 "&fields=" +
                 "&key=" + this.key +
                 "&callback=";
              break;

          case 'past-meetups':

              status = "past";
              this.url = "https://api.meetup.com/2/events?" +
                  "sign=true" +
                  "&status=" + status +
                  "&order=time" +
                  "&limited_events=False" +
                  "&group_urlname=" + this.urlName +
                  "&desc=false" +
                  "&offset=0" +
                  "&photo-host=public" +
                  "&format=json" +
                  "&page=200" +
                  "&fields=" +
                  "&key=" + this.key +
                  "&callback=";
              break;
      }
    },

    dataLoaded: function() {
      // Make a copy of the loaded data
      this.data = this.$.jsonp.response.results;

      // trim the data set if a limit was expressed (and if that limit is
      // less than the number of objects we found)
      if (this.limit && this.limit < this.data.length) {
          this.data = this.data.splice( (this.data.length - this.limit), this.data.length);
      }

      console.log(this.data);
    }
  });
  </script>
</polymer-element>
